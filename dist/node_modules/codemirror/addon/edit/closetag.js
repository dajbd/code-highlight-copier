!function(e){"object"==typeof exports&&"object"==typeof module?e(require("node_modules/codemirror/lib/codemirror.js"),require("node_modules/codemirror/addon/fold/xml-fold.js")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../fold/xml-fold"],e):e(CodeMirror)}(function(e){function t(t){if(t.getOption("disableInput"))return e.Pass;for(var n=t.listSelections(),o=[],l=0;l<n.length;l++){if(!n[l].empty())return e.Pass;var d=n[l].head,c=t.getTokenAt(d),f=e.innerMode(t.getMode(),c.state),g=f.state;if("xml"!=f.mode.name||!g.tagName)return e.Pass;var u=t.getOption("autoCloseTags"),m="html"==f.mode.configuration,h="object"==typeof u&&u.dontCloseTags||m&&i,p="object"==typeof u&&u.indentTags||m&&s,v=g.tagName;c.end>d.ch&&(v=v.slice(0,v.length-c.end+d.ch));var b=v.toLowerCase();if(!v||"string"==c.type&&(c.end!=d.ch||!/[\"\']/.test(c.string.charAt(c.string.length-1))||1==c.string.length)||"tag"==c.type&&"closeTag"==g.type||c.string.indexOf("/")==c.string.length-1||h&&r(h,b)>-1||a(t,v,d,g,!0))return e.Pass;var y=p&&r(p,b)>-1;o[l]={indent:y,text:">"+(y?"\n\n":"")+"</"+v+">",newPos:y?e.Pos(d.line+1,0):e.Pos(d.line,d.ch+1)}}for(var l=n.length-1;l>=0;l--){var x=o[l];t.replaceRange(x.text,n[l].head,n[l].anchor,"+insert");var P=t.listSelections().slice(0);P[l]={head:x.newPos,anchor:x.newPos},t.setSelections(P),x.indent&&(t.indentLine(x.newPos.line,null,!0),t.indentLine(x.newPos.line+1,null,!0))}}function n(t,n){for(var o=t.listSelections(),r=[],i=n?"/":"</",s=0;s<o.length;s++){if(!o[s].empty())return e.Pass;var l=o[s].head,d=t.getTokenAt(l),c=e.innerMode(t.getMode(),d.state),f=c.state;if(n&&("string"==d.type||"<"!=d.string.charAt(0)||d.start!=l.ch-1))return e.Pass;var g;if("xml"!=c.mode.name)if("htmlmixed"==t.getMode().name&&"javascript"==c.mode.name)g=i+"script";else{if("htmlmixed"!=t.getMode().name||"css"!=c.mode.name)return e.Pass;g=i+"style"}else{if(!f.context||!f.context.tagName||a(t,f.context.tagName,l,f))return e.Pass;g=i+f.context.tagName}">"!=t.getLine(l.line).charAt(d.end)&&(g+=">"),r[s]=g}t.replaceSelections(r),o=t.listSelections();for(var s=0;s<o.length;s++)(s==o.length-1||o[s].head.line<o[s+1].head.line)&&t.indentLine(o[s].head.line)}function o(t){return t.getOption("disableInput")?e.Pass:n(t,!0)}function r(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;o>n;++n)if(e[n]==t)return n;return-1}function a(t,n,o,r,a){if(!e.scanForClosingTag)return!1;var i=Math.min(t.lastLine()+1,o.line+500),s=e.scanForClosingTag(t,o,null,i);if(!s||s.tag!=n)return!1;for(var l=r.context,d=a?1:0;l&&l.tagName==n;l=l.prev)++d;o=s.to;for(var c=1;d>c;c++){var f=e.scanForClosingTag(t,o,null,i);if(!f||f.tag!=n)return!1;o=f.to}return!0}e.defineOption("autoCloseTags",!1,function(n,r,a){if(a!=e.Init&&a&&n.removeKeyMap("autoCloseTags"),r){var i={name:"autoCloseTags"};("object"!=typeof r||r.whenClosing)&&(i["'/'"]=function(e){return o(e)}),("object"!=typeof r||r.whenOpening)&&(i["'>'"]=function(e){return t(e)}),n.addKeyMap(i)}});var i=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],s=["applet","blockquote","body","button","div","dl","fieldset","form","frameset","h1","h2","h3","h4","h5","h6","head","html","iframe","layer","legend","object","ol","p","select","table","ul"];e.commands.closeTag=function(e){return n(e)}});