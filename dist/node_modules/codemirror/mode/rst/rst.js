!function(e){"object"==typeof exports&&"object"==typeof module?e(require("node_modules/codemirror/lib/codemirror.js"),require("node_modules/codemirror/mode/python/python.js"),require("node_modules/codemirror/mode/stex/stex.js"),require("node_modules/codemirror/addon/mode/overlay.js")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../python/python","../stex/stex","../../addon/mode/overlay"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("rst",function(t,a){var c=/^\*\*[^\*\s](?:[^\*]*[^\*\s])?\*\*/,r=/^\*[^\*\s](?:[^\*]*[^\*\s])?\*/,n=/^``[^`\s](?:[^`]*[^`\s])``/,o=/^(?:[\d]+(?:[\.,]\d+)*)/,m=/^(?:\s\+[\d]+(?:[\.,]\d+)*)/,s=/^(?:\s\-[\d]+(?:[\.,]\d+)*)/,l="[Hh][Tt][Tt][Pp][Ss]?://",i="(?:[\\d\\w.-]+)\\.(?:\\w{2,6})",d="(?:/[\\d\\w\\#\\%\\&\\-\\.\\,\\/\\:\\=\\?\\~]+)*",h=new RegExp("^"+l+i+d),p={token:function(e){if(e.match(c)&&e.match(/\W+|$/,!1))return"strong";if(e.match(r)&&e.match(/\W+|$/,!1))return"em";if(e.match(n)&&e.match(/\W+|$/,!1))return"string-2";if(e.match(o))return"number";if(e.match(m))return"positive";if(e.match(s))return"negative";if(e.match(h))return"link";for(;!(null==e.next()||e.match(c,!1)||e.match(r,!1)||e.match(n,!1)||e.match(o,!1)||e.match(m,!1)||e.match(s,!1)||e.match(h,!1)););return null}},u=e.getMode(t,a.backdrop||"rst-base");return e.overlayMode(u,p,!0)},"python","stex"),e.defineMode("rst-base",function(t){function a(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,a){return"undefined"!=typeof t[a]?t[a]:e})}function c(t,a){var n=null;if(t.sol()&&t.match(V,!1))i(a,s,{mode:p,local:e.startState(p)});else if(t.sol()&&t.match($))i(a,r),n="meta";else if(t.sol()&&t.match(v))i(a,c),n="header";else if(h(a)==P||t.match(P,!1))switch(d(a)){case 0:i(a,c,l(P,1)),t.match(/^:/),n="meta";break;case 1:i(a,c,l(P,2)),t.match(b),n="keyword",t.current().match(/^(?:math|latex)/)&&(a.tmp_stex=!0);break;case 2:i(a,c,l(P,3)),t.match(/^:`/),n="meta";break;case 3:if(a.tmp_stex&&(a.tmp_stex=void 0,a.tmp={mode:u,local:e.startState(u)}),a.tmp){if("`"==t.peek()){i(a,c,l(P,4)),a.tmp=void 0;break}n=a.tmp.mode.token(t,a.tmp.local);break}i(a,c,l(P,4)),t.match(y),n="string";break;case 4:i(a,c,l(P,5)),t.match(/^`/),n="meta";break;case 5:i(a,c,l(P,6)),t.match(k);break;default:i(a,c)}else if(h(a)==z||t.match(z,!1))switch(d(a)){case 0:i(a,c,l(z,1)),t.match(/^`/),n="meta";break;case 1:i(a,c,l(z,2)),t.match(y),n="string";break;case 2:i(a,c,l(z,3)),t.match(/^`:/),n="meta";break;case 3:i(a,c,l(z,4)),t.match(b),n="keyword";break;case 4:i(a,c,l(z,5)),t.match(/^:/),n="meta";break;case 5:i(a,c,l(z,6)),t.match(k);break;default:i(a,c)}else if(h(a)==B||t.match(B,!1))switch(d(a)){case 0:i(a,c,l(B,1)),t.match(/^:/),n="meta";break;case 1:i(a,c,l(B,2)),t.match(b),n="keyword";break;case 2:i(a,c,l(B,3)),t.match(/^:/),n="meta";break;case 3:i(a,c,l(B,4)),t.match(k);break;default:i(a,c)}else if(h(a)==T||t.match(T,!1))switch(d(a)){case 0:i(a,c,l(T,1)),t.match(G),n="variable-2";break;case 1:i(a,c,l(T,2)),t.match(/^_?_?/)&&(n="link");break;default:i(a,c)}else if(t.match(I))i(a,c),n="quote";else if(t.match(A))i(a,c),n="quote";else if(t.match(C))i(a,c),(!t.peek()||t.peek().match(/^\W$/))&&(n="link");else if(h(a)==H||t.match(H,!1))switch(d(a)){case 0:!t.peek()||t.peek().match(/^\W$/)?i(a,c,l(H,1)):t.match(H);break;case 1:i(a,c,l(H,2)),t.match(/^`/),n="link";break;case 2:i(a,c,l(H,3)),t.match(y);break;case 3:i(a,c,l(H,4)),t.match(/^`_/),n="link";break;default:i(a,c)}else t.match(U)?i(a,o):t.next()&&i(a,c);return n}function r(t,a){var o=null;if(h(a)==W||t.match(W,!1))switch(d(a)){case 0:i(a,r,l(W,1)),t.match(G),o="variable-2";break;case 1:i(a,r,l(W,2)),t.match(J);break;case 2:i(a,r,l(W,3)),t.match(K),o="keyword";break;case 3:i(a,r,l(W,4)),t.match(L),o="meta";break;default:i(a,c)}else if(h(a)==M||t.match(M,!1))switch(d(a)){case 0:i(a,r,l(M,1)),t.match(D),o="keyword",t.current().match(/^(?:math|latex)/)?a.tmp_stex=!0:t.current().match(/^python/)&&(a.tmp_py=!0);break;case 1:i(a,r,l(M,2)),t.match(F),o="meta",(t.match(/^latex\s*$/)||a.tmp_stex)&&(a.tmp_stex=void 0,i(a,s,{mode:u,local:e.startState(u)}));break;case 2:i(a,r,l(M,3)),(t.match(/^python\s*$/)||a.tmp_py)&&(a.tmp_py=void 0,i(a,s,{mode:p,local:e.startState(p)}));break;default:i(a,c)}else if(h(a)==S||t.match(S,!1))switch(d(a)){case 0:i(a,r,l(S,1)),t.match(N),t.match(O),o="link";break;case 1:i(a,r,l(S,2)),t.match(Q),o="meta";break;default:i(a,c)}else t.match(q)?(i(a,c),o="quote"):t.match(j)?(i(a,c),o="quote"):(t.eatSpace(),t.eol()?i(a,c):(t.skipToEnd(),i(a,n),o="comment"));return o}function n(e,t){return m(e,t,"comment")}function o(e,t){return m(e,t,"meta")}function m(e,t,a){return e.eol()||e.eatSpace()?(e.skipToEnd(),a):(i(t,c),null)}function s(e,t){return t.ctx.mode&&t.ctx.local?e.sol()?(e.eatSpace()||i(t,c),null):t.ctx.mode.token(e,t.ctx.local):(i(t,c),null)}function l(e,t,a,c){return{phase:e,stage:t,mode:a,local:c}}function i(e,t,a){e.tok=t,e.ctx=a||{}}function d(e){return e.ctx.stage||0}function h(e){return e.ctx.phase}var p=e.getMode(t,"python"),u=e.getMode(t,"stex"),f="\\s+",x="(?:\\s*|\\W|$)",k=new RegExp(a("^{0}",x)),w="(?:[^\\W\\d_](?:[\\w!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)",b=new RegExp(a("^{0}",w)),g="(?:[^\\W\\d_](?:[\\w\\s!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)",E=a("(?:{0}|`{1}`)",w,g),_="(?:[^\\s\\|](?:[^\\|]*[^\\s\\|])?)",R="(?:[^\\`]+)",y=new RegExp(a("^{0}",R)),v=new RegExp("^([!'#$%&\"()*+,-./:;<=>?@\\[\\\\\\]^_`{|}~])\\1{3,}\\s*$"),$=new RegExp(a("^\\.\\.{0}",f)),S=new RegExp(a("^_{0}:{1}|^__:{1}",E,x)),M=new RegExp(a("^{0}::{1}",E,x)),W=new RegExp(a("^\\|{0}\\|{1}{2}::{3}",_,f,E,x)),q=new RegExp(a("^\\[(?:\\d+|#{0}?|\\*)]{1}",E,x)),j=new RegExp(a("^\\[{0}\\]{1}",E,x)),T=new RegExp(a("^\\|{0}\\|",_)),I=new RegExp(a("^\\[(?:\\d+|#{0}?|\\*)]_",E)),A=new RegExp(a("^\\[{0}\\]_",E)),C=new RegExp(a("^{0}__?",E)),H=new RegExp(a("^`{0}`_",R)),P=new RegExp(a("^:{0}:`{1}`{2}",w,R,x)),z=new RegExp(a("^`{1}`:{0}:{2}",w,R,x)),B=new RegExp(a("^:{0}:{1}",w,x)),D=new RegExp(a("^{0}",E)),F=new RegExp(a("^::{0}",x)),G=new RegExp(a("^\\|{0}\\|",_)),J=new RegExp(a("^{0}",f)),K=new RegExp(a("^{0}",E)),L=new RegExp(a("^::{0}",x)),N=new RegExp("^_"),O=new RegExp(a("^{0}|_",E)),Q=new RegExp(a("^:{0}",x)),U=new RegExp("^::\\s*$"),V=new RegExp("^\\s+(?:>>>|In \\[\\d+\\]:)\\s");return{startState:function(){return{tok:c,ctx:l(void 0,0)}},copyState:function(t){var a=t.ctx,c=t.tmp;return a.local&&(a={mode:a.mode,local:e.copyState(a.mode,a.local)}),c&&(c={mode:c.mode,local:e.copyState(c.mode,c.local)}),{tok:t.tok,ctx:a,tmp:c}},innerMode:function(e){return e.tmp?{state:e.tmp.local,mode:e.tmp.mode}:e.ctx.mode?{state:e.ctx.local,mode:e.ctx.mode}:null},token:function(e,t){return t.tok(e,t)}}},"python","stex"),e.defineMIME("text/x-rst","rst")});